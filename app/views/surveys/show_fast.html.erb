<%= render :partial => 'surveys/survey_header' %>

<br>

<div id='draft-message' style='color:red;'></div>

<% if current_user.access? :survey_show_fast_input %>
<div class="command">
	<% url = 
	if @options[:show_only]
		survey_show_only_path(@survey)
	else
		survey_path(@journal_entry)
	end %>
	<%= link_button t('survey.input'), url, 'survey_input', :title => 'Besvar med normal indtastning' %>
</div>
<% end %>


<br>

<a href='javascript:toggleComments(surveyform)'>Skriv kommentarer</a>



<!-- DO NOT TOUCH THIS! -->
<% unless @options[:action] =~ /show/ %>
		<form action="/survey_answers/create/<%= @journal_entry.id %>" id="surveyform" method="post" onsubmit="return submitAction;" >
<% end %>

	<div>
		<%= render :partial => "surveys/answer_by" %>
	</div>
	<br>

	<%= render :partial => "surveys/question_fast", :collection => @survey.questions %>

	<% unless @options[:action] =~ /show/ %>
		<a class='button' id='send_form' >
			<span onclick="document.forms[0].submit(); $('send_form').hide(); $('sending_form').show();">Send svar</span>
		</a>
		<div id="sending_form" style="display: none;">
			<a class='send_form' href='#'>
				<span class="send_survey">Sender svar...</span>
			</a>
		</div>
	<% end %>

	<div id="submitting" style="border: 1px solid green; padding: 8px; display: none;">Sender svar...</div>
	
	<% unless @options[:action] =~ /show/ %>
	</form>

	<% unless @options[:action] =~ /show|edit/ && !@options[:show_only] %>
		<%= observe_form "surveyform",
				 :url => survey_save_draft_path(@journal_entry),
				 :update => "draft-message",
				 :frequency => SAVE_DRAFT_INTERVAL %>
	<% end %>

	<!-- Put before validation.add -->
	<script type='text/javascript'>

		function formCallback(result, form) {
			if(!result) {
				window.status = "Der er manglende eller forkerte v√¶rdier i besvarelsen";
				return false;
			}
			if(result) { 
				window.status = "Sender besvarelsen...";
			}
			return true;
		}
		var valid = new Validation('surveyform', {immediate : true, stopOnFirst : true, onFormValidate : formCallback});
	</script>
<% end %>

<p>
	<%= back_button journal_path(@journal_entry.journal) %>
</p>


<div id="debug">
</div>